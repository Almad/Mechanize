>>> from mechanize._response import test_response
>>> from test_browser import TestBrowser2, make_mock_handler

Warn early about some mistakes setting a response object

>>> import StringIO
>>> br = TestBrowser2()
>>> br.set_response("blah")
Traceback (most recent call last):
...
ValueError: not a response object
>>> br.set_response(StringIO.StringIO())
Traceback (most recent call last):
...
ValueError: not a response object


.open() without an appropriate scheme handler should fail with
URLError

>>> br = TestBrowser2()
>>> br.open("http://example.com")
Traceback (most recent call last):
...
URLError: <urlopen error unknown url type: http>

Reload after failed .open() should fail due to failure to open, not
with BrowserStateError

>>> br.reload()
Traceback (most recent call last):
...
URLError: <urlopen error unknown url type: http>


.clear_history() should do what it says on the tin.  Note that the
history does not include the current response!

>>> br = TestBrowser2()
>>> br.add_handler(make_mock_handler(test_response)([("http_open", None)]))

>>> br.response() is None
True
>>> len(br._history._history)
0

>>> r = br.open("http://example.com/1")
>>> br.response() is not None
True
>>> len(br._history._history)
0

>>> br.clear_history()
>>> br.response() is not None
True
>>> len(br._history._history)
0

>>> r = br.open("http://example.com/2")
>>> br.response() is not None
True
>>> len(br._history._history)
1

>>> br.clear_history()
>>> br.response() is not None
True
>>> len(br._history._history)
0
